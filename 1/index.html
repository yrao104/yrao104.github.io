<!DOCTYPE html>
<html>
<head>
    <title>CS 180 Project 1</title>
    <style>
        body {
            font-family: Georgia, sans-serif;
            margin: 20px;
            text-align: center;
            background: radial-gradient(circle,rgba(238, 174, 202, 1) 0%, rgba(148, 187, 233, 1) 100%);
        }

        h1 {
            margin-bottom: 30px;
            margin-top: 60px;
        }

        h2 {
            margin-bottom: 20px;
            margin-top: 0px;
        }

        .info {
            margin-left: auto;
            margin-right: auto;
            width: 80%;
            border-radius: 8px;
            text-align: left;
            background: #e6e0f5;
            padding: 50px;
        }

        .container {
            text-align: center;
        }

        .container img {
            height: auto;
            width: 100%;
            margin-top: 70px;
            margin-bottom: 0px;
        }

        hr {
            margin-top: 40px;
            margin-bottom: 40px; 
        }

        .caption {
            font-size: 15px;
            margin-top: 5px;
        }

        .row {
            display: flex;
            justify-content: center;
            gap: 5%;
        }

        p {
            margin-right: 15px;
            margin-left: 15px;
        }

    </style>
</head>
<body>
    <h1>Project #1: Images of the Russian Empire</h1>
    <h2 style="margin-bottom: 50px">Colorizing the Produkin-Gorskii Photo Collection</h2>

    <div class="info">

        <h2>Project Overview</h2>
        <p style="text-align: left;">
            This project builds off of Sergei Prokudin-Gorskii's idea of capturing different red, green, and blue filters of scenes onto glass plates and then combining them into a color image. 
            This can be done by splitting each image into the RGB color channels, combining them directly on top, and lastly aligning all three channels into a single color image. 
            Given digitized images with all three glass plates, I created an algorithm utilizing translation methods to align these glass plates and reconstruct the colored images. 
            I began with a single-scale alignment approach on smaller jpg images and then improved my algorithm to a multi-scale image pyramid in order to efficiently handle larger tif files.
        </p>
        <hr />

        <h2>Part 1: Single-Scale Alignment</h2>
        <p style="text-align: left; margin-bottom: -40px;">
            I approached single-scale alignment using a translation displacement method with a displacement range of -25 to 25. 
            For aligning each color channel to the base color channel, I first looped through nested for loops over the x and y displacements. 
            By utilizing the np.roll function, I was able to translate the image channel by the (x, y) displacement. 
            Then, I utilized the normalized cross-correlation to calculate the dot product between the normalized image vectors.
            Lastly, I found the lowest dot product to identify the best displacement to align the color channels.
            <br><br>
            I initially implemented this algorithm with the L2 norm and then switched to NCC, which had similar performance.
            In addition, I ended up cropping the images by 10% when comparing alignments since borders often result in bad alignment.
            I also made sure to crop the final image by 5% to reproduce the colored image as best as possible.
        </p>

        <div class="row">
            <div class="container">
                <img src="./media/cathedral_aligned.jpg" alt="Aligned cathedral jpg">
                <div class="caption" style="font-weight: bold;">Cathedral</div>
                <div class="caption">B to G displacement: (-2, -5)</div>
                <div class="caption">R to G displacement: (1, 7)</div>
            </div>
            <div class="container">
                <img src="./media/monastery_aligned.jpg" alt="Aligned monastery jpg">
                <div class="caption" style="font-weight: bold;">Monastery</div>
                <div class="caption">B to G displacement: (-2, 3)</div>
                <div class="caption">R to G displacement: (1, 6)</div>
            </div>
            <div class="container">
                <img src="./media/tobolsk_aligned.jpg" alt="Aligned tobolsk jpg">
                <div class="caption" style="font-weight: bold;">Tobolsk</div>
                <div class="caption">B to G displacement: (-3, -3)</div>
                <div class="caption">R to G displacement: (1, 4)</div>
            </div>
        </div>
        <hr />

        <h2>Part 2: Multi-Scale Pyramid Alignment (with NCC)</h2>
        <p style="text-align: left; margin-bottom: -40px;">
            For the multi-scale pyramid alignment portion, I built on top of my single-scale alignment approach.
            I began with a displacement range from -25 to 25 and implemented recursive calls to the single-scale alignment method. 
            Next, I added a base case to stop recursion when the images reached a size smaller than 200 x 200 pixels.
            At each image pyramid level (other than the base case), I halved the displacement range and downsampled the images by resizing them in half.
            I recursively called the overall function with the best (x, y) displacement from the previous level divided by two, then updated this displacement by a factor of 2 before passing it into the single-scale alignment method.
            <br><br>
            I initially implemented this algorithm with the L2 norm, but the alignment was pretty bad, so I switched to NCC, which drastically improved the performance.
            To speed up my algorithm, I made sure to crop the outer 10% of each color channel before alignment and calculated as much of the normalized image vectors outside the nested for loops as possible.
            Even after these changes, a few of my images (specifically emir.tif, melons.tif, and self_portrait.tif) were still slightly misaligned and the red color channel was noticeably misaligned.
            By aligning to the green channel instead of the blue channel, the alignment for larger .tif files improved significantly.    
        </p>

        <div class="row">
            <div class="container">
                <img src="./media/church_aligned.jpg" alt="Aligned church jpg">
                <div class="caption" style="font-weight: bold;">Church</div>
                <div class="caption">B to G displacement: (-4, -25)</div>
                <div class="caption">R to G displacement: (-8, 33)</div>
            </div>
            <div class="container">
                <img src="./media/emir_aligned.jpg" alt="Aligned emir jpg">
                <div class="caption" style="font-weight: bold;">Emir</div>
                <div class="caption">B to G displacement: (-24, -49)</div>
                <div class="caption">R to G displacement: (17, 57)</div>
            </div>
            <div class="container">
                <img src="./media/harvesters_aligned.jpg" alt="Aligned harvesters jpg">
                <div class="caption" style="font-weight: bold;">Harvesters</div>
                <div class="caption">B to G displacement: (-16, -59)</div>
                <div class="caption">R to G displacement: (-3, 65)</div>
            </div>
        </div>

        <div class="row">
            <div class="container">
                <img src="./media/icon_aligned.jpg" alt="Aligned icon jpg">
                <div class="caption" style="font-weight: bold;">Icon</div>
                <div class="caption">B to G displacement: (-17, -41)</div>
                <div class="caption">R to G displacement: (5, 48)</div>
            </div>
            <div class="container">
                <img src="./media/italil_aligned.jpg" alt="Aligned italil jpg">
                <div class="caption" style="font-weight: bold;">Italil</div>
                <div class="caption">B to G displacement: (-21, -38)</div>
                <div class="caption">R to G displacement: (15, 38)</div>
            </div>
            <div class="container">
                <img src="./media/lastochikino_aligned.jpg" alt="Aligned lastochikino jpg">
                <div class="caption" style="font-weight: bold;">Lastochikino</div>
                <div class="caption">B to G displacement: (2, 2)</div>
                <div class="caption">R to G displacement: (-7, 78)</div>
            </div>
        </div>

        <div class="row">
            <div class="container">
                <img src="./media/lugano_aligned.jpg" alt="Aligned lugano jpg">
                <div class="caption" style="font-weight: bold;">Lugano</div>
                <div class="caption">B to G displacement: (16, -41)</div>
                <div class="caption">R to G displacement: (-13, 52)</div>
            </div>
            <div class="container">
                <img src="./media/melons_aligned.jpg" alt="Aligned melons jpg">
                <div class="caption" style="font-weight: bold;">Melons</div>
                <div class="caption">B to G displacement: (-10, -81)</div>
                <div class="caption">R to G displacement: (3, 96)</div>
            </div>
            <div class="container">
                <img src="./media/self_portrait_aligned.jpg" alt="Aligned self portrait jpg">
                <div class="caption" style="font-weight: bold;">Self Portrait</div>
                <div class="caption">B to G displacement: (-29, -78)</div>
                <div class="caption">R to G displacement: (8, 98)</div>
            </div>
        </div>

        <div class="row">
            <div class="container">
                <img src="./media/siren_aligned.jpg" alt="Aligned siren jpg">
                <div class="caption" style="font-weight: bold;">Siren</div>
                <div class="caption">B to G displacement: (6, -49)</div>
                <div class="caption">R to G displacement: (-18, 47)</div>
            </div>
            <div class="container">
                <img src="./media/three_generations_aligned.jpg" alt="Aligned three generations jpg">
                <div class="caption" style="font-weight: bold;">Three Generations</div>
                <div class="caption">B to G displacement: (-14, -53)</div>
                <div class="caption">R to G displacement: (-3, 58)</div>
            </div>
            <div class="container">
                <img src="./media/mosque_aligned.jpg" alt="Aligned mosque jpg">
                <div class="caption" style="font-weight: bold;">Additional: Mosque</div>
                <div class="caption">B to G displacement: (-10, -26)</div>
                <div class="caption">R to G displacement: (1, 44)</div>
            </div>
        </div>

        <div class="row">
            <div class="container">
                <img src="./media/railroad_depot_aligned.jpg" alt="Aligned railroad depot jpg">
                <div class="caption" style="font-weight: bold;">Additional: Railroad Depot</div>
                <div class="caption">B to G displacement: (7, -36)</div>
                <div class="caption">R to G displacement: (-10, 87)</div>
            </div>
            <div class="container">
                <img src="./media/pamiatnik_aligned.jpg" alt="Aligned pamiatnik jpg">
                <div class="caption" style="font-weight: bold;">Additional: Pamiatnik</div>
                <div class="caption">B to G displacement: (-27, -14)</div>
                <div class="caption">R to G displacement: (24, 71)</div>
            </div>
            <div class="container">
                <img src="./media/stonegate_aligned.jpg" alt="Aligned stonegate jpg">
                <div class="caption" style="font-weight: bold;">Additional: Stonegate</div>
                <div class="caption">B to G displacement: (-3, -34)</div>
                <div class="caption">R to G displacement: (1, 64)</div>
            </div>
        </div>
        
    </div>

</body>
</html>
